<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Chain Lending</title>

    <!-- Favicon -->
    <link rel="icon" href="frontend/favicon.ico" type="image/x-icon">

    <!-- Link to CSS (if you have a style file) -->
    <link rel="stylesheet" href="style.css">

    <!-- Optional: Link to external libraries or fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bona+Nova&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Bona Nova', serif;
            transition: background-color 0.3s, color 0.3s;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Light mode styles */
        body.light-mode {
            background-color: #f0f0f0;
            color: #333;
        }

        /* Dark mode styles */
        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        header {
            background: #007bff;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        h1 {
            margin: 0;
        }

        #theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            color: inherit; /* Inherit color from body */
        }

        #back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            color: white;
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        input[type="number"] {
            padding: 10px;
            margin: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 200px;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        footer {
            text-align: center;
            padding: 10px;
            background: #007bff;
            color: white;
        }
    </style>
</head>

<body class="light-mode">
    <header>
        <h1>Welcome to Cross-Chain Lending</h1>
        <!-- Back button -->
        <button id="back-button" onclick="window.location.href='afterlogin.html'">ðŸ”™</button>
        <!-- Connect wallet button -->
        <button id="connect-wallet">Connect Wallet</button>
        <p id="wallet-info"></p>
        <!-- Theme toggle button -->
        <button id="theme-toggle">ðŸŒ™</button>
    </header>

    <main>
        <h2>Lend or Borrow Crypto</h2>
        <div class="input-group">
            <input type="number" id="lend-amount" placeholder="Enter amount to lend">
            <button id="lend-btn">Lend</button>
        </div>
        <div class="input-group">
            <input type="number" id="borrow-amount" placeholder="Enter amount to borrow">
            <button id="borrow-btn">Borrow</button>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Cross-Chain Lending. All rights reserved.</p>
    </footer>

    <!-- Link to wallet.js script for wallet connection -->
    <script src="wallet.js"></script>

    <!-- External library: CosmJS for Cosmos Blockchain -->
    <script src="https://cdn.jsdelivr.net/npm/@cosmjs/stargate@0.24.0/build/main.bundle.js"></script>

    <script>
        // Theme toggle functionality
        const themeToggleButton = document.getElementById('theme-toggle');
        themeToggleButton.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('light-mode');
            themeToggleButton.textContent = document.body.classList.contains('dark-mode') ? 'ðŸŒ•' : 'ðŸŒ™'; // Change icon
        });

        // Check if Leap Wallet is installed
        if (window.leap && window.leap.enable) {
            console.log('Leap Cosmos Wallet detected');

            const connectWalletButton = document.getElementById('connect-wallet');
            const walletInfo = document.getElementById('wallet-info');
            const lendButton = document.getElementById('lend-btn');
            const borrowButton = document.getElementById('borrow-btn');
            const lendAmountInput = document.getElementById('lend-amount');
            const borrowAmountInput = document.getElementById('borrow-amount');

            // Connect Wallet Button
            connectWalletButton.addEventListener('click', async () => {
                try {
                    // Enable Leap Wallet (this requests the user to connect their wallet)
                    await window.leap.enable();

                    const account = await window.leap.getAccount(); // Get user's Cosmos account
                    console.log('Connected Account:', account.address);
                    walletInfo.textContent = `Wallet connected: ${account.address}`;

                    // Store account information in localStorage (for later use)
                    localStorage.setItem('cosmosAccount', JSON.stringify(account));

                    // Hide the "Connect Wallet" button and display the account address
                    connectWalletButton.style.display = 'none';
                } catch (error) {
                    console.error('Error connecting wallet:', error);
                    alert('Error connecting wallet');
                }
            });

            // Lend Button (handle lending logic)
            lendButton.addEventListener('click', async () => {
                const amount = lendAmountInput.value;

                if (amount) {
                    const account = JSON.parse(localStorage.getItem('cosmosAccount'));
                    if (account) {
                        const senderAddress = account.address;
                        alert(`Lending ${amount} tokens from ${senderAddress}...`);

                        // Implement lending functionality here
                        // Example: Connect to Cosmos smart contract and send the transaction

                    } else {
                        alert('Please connect your wallet first.');
                    }
                } else {
                    alert("Please enter a valid amount to lend.");
                }
            });

            // Borrow Button (handle borrowing logic)
            borrowButton.addEventListener('click', async () => {
                const amount = borrowAmountInput.value;

                if (amount) {
                    const account = JSON.parse(localStorage.getItem('cosmosAccount'));
                    if (account) {
                        const senderAddress = account.address;
                        alert(`Borrowing ${amount} tokens from ${senderAddress}...`);

                        // Implement borrowing functionality here
                        // Example: Connect to Cosmos smart contract and send the transaction

                    } else {
                        alert('Please connect your wallet first.');
                    }
                } else {
                    alert("Please enter a valid amount to borrow.");
                }
            });

        } else {
            console.log('Leap Cosmos Wallet is not installed.');
            alert('Please install Leap Cosmos Wallet to use this feature.');
        }
    </script>
</body>

</html>